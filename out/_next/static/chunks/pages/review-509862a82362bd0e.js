(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[588],{6969:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>p});var n=t(7876),i=t(4232),a=t(2934),o=t(3028),s=t.n(o),l=t(9099),c=t(3679),d=t(7328),g=t.n(d);function p(){var e;let{data:r,status:t}=(0,a.useSession)(),[o,d]=(0,i.useState)(""),[p,u]=(0,i.useState)(""),[h,x]=(0,i.useState)(!1),[f,j]=(0,i.useState)(0),[y,b]=(0,i.useState)(""),[w,v]=(0,i.useState)(""),[R,C]=(0,i.useState)("/logo.png"),[k,S]=(0,i.useState)([]),[_,E]=(0,i.useState)(!1),[F,I]=(0,i.useState)(""),T=(0,i.useRef)(),A=(0,i.useRef)(),N=(0,l.useRouter)();return((0,i.useEffect)(()=>{r&&v(r.user.email)},[r]),(0,i.useEffect)(()=>{o?(console.log("Fetching anime for:",o),fetch("https://api.jikan.moe/v4/anime?q=".concat(encodeURIComponent(o),"&limit=5")).then(e=>e.json()).then(e=>{var r;console.log("Search results count:",(null==(r=e.data)?void 0:r.length)||0),S(e.data||[]),E(!0)}).catch(()=>{console.log("Fetch error, clearing search results"),S([])})):(S([]),E(!1))},[o]),console.log("showDropdown:",_,"searchResults length:",k.length),(0,i.useEffect)(()=>{let e=e=>{T.current&&!T.current.contains(e.target)&&E(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,i.useEffect)(()=>{k.find(e=>e.title===o)||x(!1)},[o,k]),"loading"===t)?(0,n.jsx)("div",{children:"Loading session..."}):"unauthenticated"===t?(0,n.jsx)("div",{children:"Please login to create a review poster."}):(0,n.jsxs)("div",{style:{backgroundColor:"#1c1c1c",color:"white",minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",padding:"20px",flexDirection:"column",fontFamily:"monospace"},children:[(0,n.jsx)(g(),{children:(0,n.jsx)("link",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css",integrity:"sha512-1ycn6Ica999yYx8hTJoNx5RZZSxUXp2tY2Vz+aJrFus2HRw8NjzAeF5qVbI6LcgIpGsU8GgY2mMRYeD1R6A36w==",crossOrigin:"anonymous",referrerPolicy:"no-referrer"})}),(0,n.jsxs)("button",{onClick:()=>N.back(),style:{marginBottom:"1rem",padding:"10px",backgroundColor:"#333",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"16px",display:"flex",alignItems:"center"},children:[(0,n.jsx)(c.QVr,{style:{marginRight:"10px"}})," Back"]}),(0,n.jsxs)("div",{style:{textAlign:"center",maxWidth:"600px",width:"100%"},children:[(0,n.jsx)("h1",{children:"Create Review Poster"}),(0,n.jsxs)("form",{style:{display:"flex",flexDirection:"column",gap:"1rem",position:"relative",width:"100%",maxWidth:"600px",marginBottom:"2rem"},children:[(0,n.jsxs)("label",{children:["Anime Name:",(0,n.jsxs)("div",{ref:T,style:{position:"relative"},children:[(0,n.jsx)("input",{type:"text",value:o,onChange:e=>d(e.target.value),onFocus:()=>E(!0),style:{width:"100%",padding:"10px",backgroundColor:"#333",color:"white",border:"1px solid #ccc",borderRadius:"4px",marginBottom:"1rem"}}),_&&k.length>0&&(0,n.jsx)("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"#333",border:"1px solid #ccc",borderRadius:"4px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,marginTop:"0.5rem"},children:k.map(e=>(0,n.jsxs)("div",{onClick:()=>{console.log("Dropdown item clicked:",e.title),d(e.title),u(e.images.jpg.image_url),I(e.images.jpg.image_url),console.log("Setting animeImage to:",e.images.jpg.image_url),x(!0),S([]),E(!1)},style:{display:"flex",alignItems:"center",padding:"10px",cursor:"pointer",borderBottom:"1px solid #555",color:"white"},children:[(0,n.jsx)("img",{src:e.images.jpg.image_url,alt:e.title,style:{width:"50px",height:"70px",borderRadius:"4px",marginRight:"10px"}}),(0,n.jsx)("span",{children:e.title})]},e.mal_id))})]})]}),(0,n.jsxs)("label",{children:["Rating (0 to 5):",(0,n.jsx)("input",{type:"number",min:"0",max:"5",step:"0.1",value:f,onChange:e=>{let r=e.target.value;j(""===r?"":parseFloat(r)),parseFloat(r)>5?b("The highest point for rating is 5"):b("")},onBlur:()=>{let e=parseFloat(f);(isNaN(e)||e<0)&&(e=0),e>5&&(e=5),j(e)},style:{width:"100%",padding:"10px",backgroundColor:"#333",color:"white",border:"1px solid #ccc",borderRadius:"4px"}})]}),y&&(0,n.jsx)("div",{style:{color:"red",marginTop:"4px"},children:y}),(0,n.jsxs)("div",{style:{marginTop:"10px",fontSize:"1.5rem"},children:[(0,n.jsx)("strong",{children:"Rating: "}),(e=>{let r=Math.min(Math.max(e,0),5),t=Math.floor(r),i=r%1!=0;return(0,n.jsxs)(n.Fragment,{children:[[...Array(t)].map((e,r)=>(0,n.jsx)("span",{role:"img","aria-label":"star",children:"⭐"},"full-".concat(r))),i&&(0,n.jsx)("span",{role:"img","aria-label":"half-star",children:"⭐"}),[...Array(5-t-!!i)].map((e,r)=>(0,n.jsx)("span",{role:"img","aria-label":"empty-star",children:"☆"},"empty-".concat(r)))]})})(f)]})]}),(0,n.jsxs)("div",{ref:A,style:{marginTop:"20px",display:"flex",justifyContent:"center"},children:[(0,n.jsx)(m,{animeImage:F||p,userImage:(null==r||null==(e=r.user)?void 0:e.image)||"/default-user.png",rating:f,username:w,companyLogo:R}),console.log("ReviewPoster animeImage prop:",F||p)]}),(0,n.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,n.jsx)("button",{onClick:()=>{if(!A.current)return;let e=new Image;e.src=p,e.onload=()=>{s()(A.current,{useCORS:!0,logging:!0}).then(e=>{let r=document.createElement("a");r.download="review-poster.png",r.href=e.toDataURL("image/png"),r.click()}).catch(e=>{console.error("Error generating canvas:",e)})}},style:{marginRight:"1rem",padding:"10px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px"},children:"Download Poster"}),(0,n.jsx)("button",{onClick:()=>{A.current&&s()(A.current,{useCORS:!0}).then(e=>{e.toBlob(e=>{if(!e)return;let r=[new File([e],"review-poster.png",{type:"image/png",lastModified:new Date().getTime()})];navigator.canShare&&navigator.canShare({files:r})?navigator.share({files:r,title:"My Anime Review Poster",text:"Check out my anime review poster!"}):alert("Sharing not supported on this browser.")})}).catch(e=>{console.error("Error during share:",e)})},style:{padding:"10px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px"},children:"Share Poster"})]})]})]})}let m=e=>{let{animeImage:r,userImage:t,rating:a,username:o,companyLogo:s}=e,[l,c]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{c(!1)},[r]),(0,n.jsxs)("div",{style:{backgroundColor:"#333",padding:"20px",borderRadius:"8px",width:"100%",maxWidth:"400px"},children:[(0,n.jsxs)("h2",{children:[o,"'s Review"]}),(0,n.jsx)("img",{src:t,alt:"User",style:{width:"50px",borderRadius:"50%"}}),(0,n.jsx)("img",{src:l||!r?"/fallback-anime.png":r,alt:"Anime",style:{width:"100%",height:"auto",marginTop:"10px",borderRadius:"8px"},onError:()=>c(!0)}),(0,n.jsxs)("div",{style:{marginTop:"10px",fontSize:"1.5rem"},children:[(0,n.jsx)("strong",{children:"Rating: "}),(e=>{let r=Math.min(Math.max(e,0),5),t=Math.floor(r),i=r%1!=0;return(0,n.jsxs)(n.Fragment,{children:[[...Array(t)].map((e,r)=>(0,n.jsx)("span",{role:"img","aria-label":"star",children:"⭐"},"full-".concat(r))),i&&(0,n.jsx)("span",{role:"img","aria-label":"half-star",children:"⭐"}),[...Array(5-t-!!i)].map((e,r)=>(0,n.jsx)("span",{role:"img","aria-label":"empty-star",children:"☆"},"empty-".concat(r)))]})})(a)]}),(0,n.jsx)("img",{src:s,alt:"Company Logo",style:{width:"50px",marginTop:"10px"}})]})}},7436:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/review",function(){return t(6969)}])}},e=>{var r=r=>e(e.s=r);e.O(0,[938,366,587,636,593,792],()=>r(7436)),_N_E=e.O()}]);