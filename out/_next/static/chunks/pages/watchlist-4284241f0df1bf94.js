(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[921],{6162:(e,t,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/watchlist",function(){return i(7980)}])},7980:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>o});var n=i(7876),a=i(4232),r=i(2934);function o(){let{data:e,status:t,update:i}=(0,r.useSession)(),[o,s]=(0,a.useState)([]),[d,l]=(0,a.useState)(!0),[c,h]=(0,a.useState)(null),[m,p]=(0,a.useState)("watched"),[u,x]=(0,a.useState)(""),[g,j]=(0,a.useState)(""),[f,b]=(0,a.useState)(""),[w,v]=(0,a.useState)(""),[y,_]=(0,a.useState)([]),[k,S]=(0,a.useState)(!1),C=(0,a.useRef)(),[T,R]=(0,a.useState)({}),E=(0,a.useRef)(!1);(0,a.useEffect)(()=>{"authenticated"!==t||(null==e?void 0:e.accessToken)||E.current||(i(),E.current=!0)},[t,e,i]),(0,a.useEffect)(()=>{"authenticated"===t&&(null==e?void 0:e.accessToken)?fetch("/api/watchlist",{headers:{Authorization:"Bearer ".concat(e.accessToken)}}).then(e=>e.json()).then(e=>{Array.isArray(e)?s(e):e&&void 0===e.length?s([e]):s([]),l(!1)}).catch(()=>{h("Failed to load watchlist"),l(!1)}):l(!1)},[t,e]),(0,a.useEffect)(()=>{let e=setTimeout(()=>{w.trim()?fetch("https://api.jikan.moe/v4/anime?q=".concat(encodeURIComponent(w),"&limit=5")).then(e=>e.json()).then(e=>{_(e.data||[]),S(!0)}).catch(()=>{_([])}):(_([]),S(!1))},500);return()=>clearTimeout(e)},[w]),(0,a.useEffect)(()=>{let e=e=>{C.current&&!C.current.contains(e.target)&&S(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,a.useEffect)(()=>{async function e(){let e={};for(let t of o)try{let i=await fetch("https://api.jikan.moe/v4/anime/".concat(t.anime_id));if(i.ok){let n=await i.json();e[t.anime_id]=n.data.title}else e[t.anime_id]="Unknown Title"}catch(i){e[t.anime_id]="Unknown Title"}R(e)}o.length>0&&e()},[o]);let N=async t=>{if(t.preventDefault(),!f||!g)return void alert("Please select an anime from the dropdown.");let i=y.find(e=>e.mal_id===g),n=i?i.images.jpg.image_url:null,a=await fetch("/api/watchlist",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.accessToken)},body:JSON.stringify({anime_id:g.toString(),status:m,comment:u,image_url:n})});if(a.ok){let e=await a.json();s(t=>t.find(e=>e.anime_id===g)?t.map(t=>t.anime_id===g?e[0]:t):[...t,e[0]]),b(""),j(""),v(""),x("")}else alert("Failed to update watchlist: "+((await a.json()).error||"Unknown error"))};return"loading"===t?(0,n.jsx)("div",{children:"Loading session..."}):"unauthenticated"===t?(0,n.jsx)("div",{children:"Please login to view your watchlist."}):(0,n.jsxs)("div",{className:"container",style:{display:"flex",gap:"2rem",alignItems:"flex-start",backgroundColor:"black",padding:"2rem",minHeight:"100vh",color:"white"},children:[(0,n.jsxs)("div",{style:{flex:1,backgroundColor:"#2a2a2a",borderRadius:"8px",padding:"2rem",boxShadow:"0 10px 20px rgba(0, 0, 0, 0.2)"},children:[(0,n.jsx)("h1",{children:"Your Watchlist"}),d?(0,n.jsxs)("div",{style:{textAlign:"center",padding:"2rem"},children:[(0,n.jsx)("div",{className:"loader"}),(0,n.jsx)("p",{children:"Loading watchlist..."})]}):c?(0,n.jsx)("p",{style:{color:"red"},children:c}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("ul",{children:o.map(e=>(0,n.jsxs)("li",{style:{marginBottom:"1rem"},children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Anime ID:"})," ",e.anime_id]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Status:"})," ",e.status]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Comment:"})," ",e.comment||"No comment"]})]},e.id))}),(0,n.jsxs)("form",{onSubmit:N,style:{marginTop:"2rem"},children:[(0,n.jsxs)("div",{style:{marginTop:"20px",position:"relative"},ref:C,children:[(0,n.jsx)("label",{children:"Search Anime:"}),(0,n.jsx)("input",{type:"text",placeholder:"Search anime...",value:w,onChange:e=>{v(e.target.value),j("")},onFocus:()=>{y.length>0&&S(!0)},style:{width:"100%",padding:"8px",fontSize:"1rem",borderRadius:"4px",border:"1px solid #ccc",marginBottom:"1rem",backgroundColor:"#333",color:"white"}}),k&&y.length>0&&(0,n.jsx)("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"white",border:"1px solid #ccc",borderRadius:"4px",marginTop:"4px",maxHeight:"300px",overflowY:"auto",zIndex:1e3},children:y.map(e=>(0,n.jsxs)("div",{onClick:()=>{j(e.mal_id),b(e.title),v(e.title),S(!1)},style:{display:"flex",alignItems:"center",padding:"8px",cursor:"pointer",borderBottom:"1px solid #eee",backgroundColor:"#333",color:"white"},children:[(0,n.jsx)("img",{src:e.images.jpg.image_url,alt:e.title,style:{width:"50px",height:"70px",borderRadius:"4px",marginRight:"10px",objectFit:"cover"}}),(0,n.jsx)("span",{style:{fontSize:"1rem",padding:"5px 0"},children:e.title})]},e.mal_id))})]}),(0,n.jsxs)("label",{children:["Status:",(0,n.jsxs)("select",{value:m,onChange:e=>p(e.target.value),style:{width:"100%",marginBottom:"1rem",padding:"8px",borderRadius:"4px",backgroundColor:"#333",color:"white"},children:[(0,n.jsx)("option",{value:"watched",children:"Watched"}),(0,n.jsx)("option",{value:"want to watch",children:"Want to Watch"})]})]}),(0,n.jsxs)("label",{children:["Comment:",(0,n.jsx)("textarea",{value:u,onChange:e=>x(e.target.value),style:{width:"100%",marginBottom:"1rem",padding:"8px",borderRadius:"4px",backgroundColor:"#333",color:"white"}})]}),(0,n.jsx)("button",{type:"submit",style:{width:"100%",padding:"10px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px"},disabled:!g,children:"Add / Update"})]})]})]}),(0,n.jsxs)("div",{style:{flex:1,backgroundColor:"#2a2a2a",borderRadius:"8px",padding:"2rem",boxShadow:"0 10px 20px rgba(0, 0, 0, 0.2)"},children:[(0,n.jsx)("h2",{children:"Your Animes"}),0===o.length?(0,n.jsx)("p",{children:"No animes added yet."}):(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:o.map(e=>(0,n.jsx)("div",{style:{border:"1px solid #ddd",borderRadius:"8px",padding:"1rem",backgroundColor:"#333",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},children:(0,n.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[(0,n.jsx)("img",{src:e.image_url,alt:T[e.anime_id]||"Anime",style:{width:"100px",height:"150px",objectFit:"cover",borderRadius:"8px"}}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Title:"})," ",T[e.anime_id]||"Loading..."]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"ID:"})," ",e.anime_id]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Status:"})," ",e.status]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Comment:"})," ",e.comment||"No comment"]})]})]})},e.anime_id))}),o.length>0&&(0,n.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,n.jsx)("h3",{children:"Manage Your Watchlist"}),o.map(t=>(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1rem",backgroundColor:"#444",padding:"0.5rem",borderRadius:"6px"},children:[(0,n.jsx)("img",{src:t.image_url,alt:t.anime_id,style:{width:"60px",height:"90px",borderRadius:"4px",objectFit:"cover"}}),(0,n.jsxs)("div",{style:{flex:1},children:[(0,n.jsx)("p",{children:(0,n.jsx)("strong",{children:T[t.anime_id]||t.anime_id})}),(0,n.jsxs)("p",{children:["Status: ",t.status]}),(0,n.jsxs)("p",{children:["Comment: ",t.comment||"No comment"]})]}),(0,n.jsx)("button",{onClick:async()=>{if(confirm("Remove anime ".concat(t.anime_id," from your watchlist?")))try{(await fetch("/api/watchlist",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.accessToken)},body:JSON.stringify({anime_id:t.anime_id})})).ok?s(e=>e.filter(e=>e.anime_id!==t.anime_id)):alert("Failed to remove anime from watchlist")}catch(e){alert("Error removing anime from watchlist")}},style:{backgroundColor:"#e74c3c",color:"white",border:"none",borderRadius:"4px",padding:"6px 12px",cursor:"pointer"},children:"Remove"})]},t.anime_id))]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(6162)),_N_E=e.O()}]);